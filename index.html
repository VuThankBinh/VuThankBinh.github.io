<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Chess Game</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/styles2.css">
    <link rel="stylesheet" href="lib/chessboardjs/css/chessboard-0.3.0.css">
</head>

<body>
    <h1 id="title">Chess Game</h1>
    <div id="ui">
        <div id="prefColumn">
            <div class="turnIndicatorContainer">
                <h1 id="turnIndicator">
                    Đến lượt
                </h1>
                <h2 id="gameMode">Chế độ: Người đấu Người</h2>
                <h1 id="moveCounter">Số nước có thể đi: 20</h1>

                <div class="settings">
                    <button onclick="reset()">New Game</button>
                    <button id="humanMode" onclick="setHumanMode()">VS Human</button>
                    <button id="computerMode" onclick="setComputerMode()">VS Computer</button>
                </div>
            </div>
        </div>
        <div id="human">
            <div id="boardColumn">
                <div id="spacer">
                    <div id="gameboard">
                        <div class="notation notationCol row8">8</div>
                        <div class="notation notationCol row7">7</div>
                        <div class="notation notationCol row6">6</div>
                        <div class="notation notationCol row5">5</div>
                        <div class="notation notationCol row4">4</div>
                        <div class="notation notationCol row3">3</div>
                        <div class="notation notationCol row2">2</div>
                        <div class="notation notationCol row1">1</div>

                        <div class="notation notationRow colA">A</div>
                        <div class="notation notationRow colB">B</div>
                        <div class="notation notationRow colC">C</div>
                        <div class="notation notationRow colD">D</div>
                        <div class="notation notationRow colE">E</div>
                        <div class="notation notationRow colF">F</div>
                        <div class="notation notationRow colG">G</div>
                        <div class="notation notationRow colH">H</div>

                        <div id="1A" class="field dark row1 colA"></div>
                        <div id="2A" class="field light row2 colA"></div>
                        <div id="3A" class="field dark row3 colA"></div>
                        <div id="4A" class="field light row4 colA"></div>
                        <div id="5A" class="field dark row5 colA"></div>
                        <div id="6A" class="field light row6 colA"></div>
                        <div id="7A" class="field dark row7 colA"></div>
                        <div id="8A" class="field light row8 colA"></div>

                        <div id="1B" class="field light row1 colB"></div>
                        <div id="2B" class="field dark row2 colB"></div>
                        <div id="3B" class="field light row3 colB"></div>
                        <div id="4B" class="field dark row4 colB"></div>
                        <div id="5B" class="field light row5 colB"></div>
                        <div id="6B" class="field dark row6 colB"></div>
                        <div id="7B" class="field light row7 colB"></div>
                        <div id="8B" class="field dark row8 colB"></div>

                        <div id="1C" class="field dark row1 colC"></div>
                        <div id="2C" class="field light row2 colC"></div>
                        <div id="3C" class="field dark row3 colC"></div>
                        <div id="4C" class="field light row4 colC"></div>
                        <div id="5C" class="field dark row5 colC"></div>
                        <div id="6C" class="field light row6 colC"></div>
                        <div id="7C" class="field dark row7 colC"></div>
                        <div id="8C" class="field light row8 colC"></div>

                        <div id="1D" class="field light row1 colD"></div>
                        <div id="2D" class="field dark row2 colD"></div>
                        <div id="3D" class="field light row3 colD"></div>
                        <div id="4D" class="field dark row4 colD"></div>
                        <div id="5D" class="field light row5 colD"></div>
                        <div id="6D" class="field dark row6 colD"></div>
                        <div id="7D" class="field light row7 colD"></div>
                        <div id="8D" class="field dark row8 colD"></div>

                        <div id="1E" class="field dark row1 colE"></div>
                        <div id="2E" class="field light row2 colE"></div>
                        <div id="3E" class="field dark row3 colE"></div>
                        <div id="4E" class="field light row4 colE"></div>
                        <div id="5E" class="field dark row5 colE"></div>
                        <div id="6E" class="field light row6 colE"></div>
                        <div id="7E" class="field dark row7 colE"></div>
                        <div id="8E" class="field light row8 colE"></div>

                        <div id="1F" class="field light row1 colF"></div>
                        <div id="2F" class="field dark row2 colF"></div>
                        <div id="3F" class="field light row3 colF"></div>
                        <div id="4F" class="field dark row4 colF"></div>
                        <div id="5F" class="field light row5 colF"></div>
                        <div id="6F" class="field dark row6 colF"></div>
                        <div id="7F" class="field light row7 colF"></div>
                        <div id="8F" class="field dark row8 colF"></div>

                        <div id="1G" class="field dark row1 colG"></div>
                        <div id="2G" class="field light row2 colG"></div>
                        <div id="3G" class="field dark row3 colG"></div>
                        <div id="4G" class="field light row4 colG"></div>
                        <div id="5G" class="field dark row5 colG"></div>
                        <div id="6G" class="field light row6 colG"></div>
                        <div id="7G" class="field dark row7 colG"></div>
                        <div id="8G" class="field light row8 colG"></div>

                        <div id="1H" class="field light row1 colH"></div>
                        <div id="2H" class="field dark row2 colH"></div>
                        <div id="3H" class="field light row3 colH"></div>
                        <div id="4H" class="field dark row4 colH"></div>
                        <div id="5H" class="field light row5 colH"></div>
                        <div id="6H" class="field dark row6 colH"></div>
                        <div id="7H" class="field light row7 colH"></div>
                        <div id="8H" class="field dark row8 colH"></div>

                        <img id="wpA" onclick="showMoves(this)" class="piece row2 colA" src="image/w_pawn.png">
                        <img id="wpB" onclick="showMoves(this)" class="piece row2 colB" src="image/w_pawn.png">
                        <img id="wpC" onclick="showMoves(this)" class="piece row2 colC" src="image/w_pawn.png">
                        <img id="wpD" onclick="showMoves(this)" class="piece row2 colD" src="image/w_pawn.png">
                        <img id="wpE" onclick="showMoves(this)" class="piece row2 colE" src="image/w_pawn.png">
                        <img id="wpF" onclick="showMoves(this)" class="piece row2 colF" src="image/w_pawn.png">
                        <img id="wpG" onclick="showMoves(this)" class="piece row2 colG" src="image/w_pawn.png">
                        <img id="wpH" onclick="showMoves(this)" class="piece row2 colH" src="image/w_pawn.png">

                        <img id="bpA" onclick="showMoves(this)" class="piece row7 colA" src="image/b_pawn.png">
                        <img id="bpB" onclick="showMoves(this)" class="piece row7 colB" src="image/b_pawn.png">
                        <img id="bpC" onclick="showMoves(this)" class="piece row7 colC" src="image/b_pawn.png">
                        <img id="bpD" onclick="showMoves(this)" class="piece row7 colD" src="image/b_pawn.png">
                        <img id="bpE" onclick="showMoves(this)" class="piece row7 colE" src="image/b_pawn.png">
                        <img id="bpF" onclick="showMoves(this)" class="piece row7 colF" src="image/b_pawn.png">
                        <img id="bpG" onclick="showMoves(this)" class="piece row7 colG" src="image/b_pawn.png">
                        <img id="bpH" onclick="showMoves(this)" class="piece row7 colH" src="image/b_pawn.png">

                        <img id="wrA" onclick="showMoves(this)" class="piece row1 colA" src="image/w_rook.png">
                        <img id="wrH" onclick="showMoves(this)" class="piece row1 colH" src="image/w_rook.png">

                        <img id="brA" onclick="showMoves(this)" class="piece row8 colA" src="image/b_rook.png">
                        <img id="brH" onclick="showMoves(this)" class="piece row8 colH" src="image/b_rook.png">

                        <img id="wnB" onclick="showMoves(this)" class="piece row1 colB" src="image/w_knight.png">
                        <img id="wnG" onclick="showMoves(this)" class="piece row1 colG" src="image/w_knight.png">

                        <img id="bnB" onclick="showMoves(this)" class="piece row8 colB" src="image/b_knight.png">
                        <img id="bnG" onclick="showMoves(this)" class="piece row8 colG" src="image/b_knight.png">

                        <img id="wbC" onclick="showMoves(this)" class="piece row1 colC" src="image/w_bishop.png">
                        <img id="wbF" onclick="showMoves(this)" class="piece row1 colF" src="image/w_bishop.png">

                        <img id="bbC" onclick="showMoves(this)" class="piece row8 colC" src="image/b_bishop.png">
                        <img id="bbF" onclick="showMoves(this)" class="piece row8 colF" src="image/b_bishop.png">

                        <img id="wq" onclick="showMoves(this)" class="piece row1 colD" src="image/w_queen.png">
                        <img id="bq" onclick="showMoves(this)" class="piece row8 colD" src="image/b_queen.png">

                        <img id="wk" onclick="showMoves(this)" class="piece row1 colE" src="image/w_king.png">
                        <img id="bk" onclick="showMoves(this)" class="piece row8 colE" src="image/b_king.png">
                    </div>
                </div>
                <script src="/HvsH.js"></script>
            </div>
        </div>
        <div id="computer" style="display: none;">
            <div id="board" class="board"></div>
            <div class="info">
                Search depth:
                <select id="search-depth">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>

                <br>
                <span>Positions evaluated: <span id="position-count"></span></span>
                <br>
                <span>Time: <span id="time"></span></span>
                <br>
                <span>Positions/s: <span id="positions-per-s"></span> </span>
                <br>
                <br>
                <div id="move-history" class="move-history">
                </div>
            </div>
            <script src="/lib/jquery/jquery-3.2.1.min.js"></script>
            <script src="/lib/chessboardjs/js/chess.js"></script>
            <script src="/lib/chessboardjs/js/chessboard-0.3.0.js"></script>
            <script src="/AIcode.js"></script>
        </div>
    </div>
    <script>
        function reset() {
            if(playMode === "c") {
                resetAI();
            } else {
                resetHuman();
            }
        }
        function resetHuman() {
            // Thiết lập lại bàn cờ
            setupGame();

            // Xóa tất cả các quân cờ hiện tại trên bàn cờ
            const pieces = document.querySelectorAll('.piece');
            pieces.forEach(piece => piece.remove());

            // Đặt lại các biến trạng thái
            whitesTurn = true;
            onPieceFocus = false;
            fieldOnFocus = null;
            pieceOnFocus = null;
            enPassantPawn = null;
            whiteCanCastle = true;
            blackCanCastle = true;
            wKRookMoved = false;
            bKRookMoved = false;
            wQRookMoved = false;
            bQRookMoved = false;
            checkedKingPosition = null;

            // Đặt lại các bộ đếm
            whitePawnSwapCounter = "I";
            blackPawnSwapCounter = "I";

            // Cập nhật hiển thị lượt đi
            document.getElementById("turnIndicator").textContent = "Lượt cờ: trắng";
            document.getElementById("moveCounter").textContent = "Số nước có thể đi: 20";

            // Xóa tất cả các đánh dấu trên bàn cờ
            deleteMarker();
            removeCheckedKingHighlight();

            // Đặt lại các quân cờ trên bàn cờ
            const gameboard = document.getElementById('gameboard');
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const piece = board[row][col];
                    if (piece) {
                        const img = document.createElement('img');
                        img.id = piece;
                        img.classList.add('piece');
                        img.classList.add(`row${row + 1}`);
                        img.classList.add(`col${String.fromCharCode(65 + col)}`);
                        img.src = `image/${piece.charAt(0)}_${getPieceNameFromType(piece.charAt(1))}.png`;
                        img.setAttribute('onclick', 'showMoves(this)');
                        gameboard.appendChild(img);
                    }
                }
            }

            // Nếu đang ở chế độ chơi với máy và máy đi trước (quân đen), thực hiện nước đi đầu tiên của máy
            if (playMode === "c" && !whitesTurn) {
                makeAIMove();
            }
        }
        function resetAI() {
            // Lưu giá trị Search depth hiện tại
            var currentDepth = $('#search-depth').val();

            // Reset game
            game = new Chess();
            board1.position('start');

            // Reset các biến trạng thái
            whitesTurn = true;
            onPieceFocus = false;
            fieldOnFocus = null;
            pieceOnFocus = null;
            whitePawnSwapCounter = "I";
            blackPawnSwapCounter = "I";
            enPassantPawn = null;
            whiteCanCastle = true;
            blackCanCastle = true;
            wKRookMoved = false;
            bKRookMoved = false;
            wQRookMoved = false;
            bQRookMoved = false;
            chessCheck = true;
            markedMoves = [];
            checkedKingPosition = null;

            // Cập nhật UI
            updateBoardUI();
            updateTurnIndicator();
            updateMoveCounter();

            // Xóa lịch sử nước đi
            $('#move-history').empty();

            // Reset các thống kê AI
            $('#position-count').text('0');
            $('#time').text('0');
            $('#positions-per-s').text('0');

            // Giữ nguyên giá trị Search depth
            $('#search-depth').val(currentDepth);

            console.log("Bàn cờ đã được reset. Search depth: " + currentDepth);

            // Nếu đang ở chế độ máy tính và đến lượt máy đi, thực hiện nước đi của máy
            if (playMode === "c" && !whitesTurn) {
                setTimeout(makeAIMove, 500);
            }
        }
    </script>
</body>

</html>
